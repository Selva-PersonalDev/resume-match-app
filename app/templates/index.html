<!DOCTYPE html>
<html>
<head>
    <title>Resume Match Analyzer</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-indigo-600 via-purple-600 to-pink-500 min-h-screen">

<div class="container mx-auto p-8">

    <h1 class="text-4xl font-bold text-white text-center mb-10">
        ðŸš€ Resume Match Analyzer
    </h1>

    <div class="grid md:grid-cols-2 gap-8">

        <!-- LEFT: INPUT AREA -->
        <div class="bg-white rounded-2xl shadow-2xl p-8">

            <form id="analyzeForm" class="space-y-6">

                <div>
                    <label class="block font-semibold mb-2">Upload Resume</label>
                    <input type="file" name="resume_file" required
                        class="w-full border p-3 rounded-lg">
                </div>

                <div>
                    <label class="block font-semibold mb-2">Upload JD File (Optional)</label>
                    <input type="file" name="jd_file"
                        class="w-full border p-3 rounded-lg">
                </div>

                <div>
                    <label class="block font-semibold mb-2">Or Paste Job Description</label>
                    <textarea name="jd_text"
                        class="w-full border p-3 rounded-lg h-40"
                        placeholder="Paste Job Description here..."></textarea>
                </div>

                <button type="submit"
                    class="w-full bg-indigo-600 text-white py-3 rounded-lg hover:scale-105 transition-transform duration-200">
                    Analyze Resume
                </button>
            </form>
        </div>

        <!-- RIGHT: RESULT AREA -->
        <div id="resultSection"
             class="bg-white rounded-2xl shadow-2xl p-8 hidden">

            <div class="text-center mb-6">
                <div id="scoreCircle" class="relative inline-block">
                    <svg class="w-40 h-40">
                        <circle cx="80" cy="80" r="70"
                            stroke="#e5e7eb"
                            stroke-width="15"
                            fill="none"/>
                        <circle id="scoreProgress"
                            cx="80" cy="80" r="70"
                            stroke="#4f46e5"
                            stroke-width="15"
                            fill="none"
                            stroke-dasharray="440"
                            stroke-dashoffset="440"
                            stroke-linecap="round"
                            transform="rotate(-90 80 80)"/>
                    </svg>
                    <div id="scoreText"
                         class="absolute inset-0 flex items-center justify-center text-3xl font-bold">
                    </div>
                </div>
            </div>

            <div id="resultContent" class="space-y-4 text-sm"></div>

        </div>

    </div>
</div>

<!-- Loading Overlay -->
<div id="loadingOverlay"
     class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white p-8 rounded-xl shadow-xl text-center">
        <div class="animate-spin rounded-full h-12 w-12 border-b-4 border-indigo-600 mx-auto mb-4"></div>
        <p class="text-gray-700 font-semibold">Analyzing...</p>
    </div>
</div>

<script>
const form = document.getElementById("analyzeForm");
const resultSection = document.getElementById("resultSection");
const resultContent = document.getElementById("resultContent");
const scoreProgress = document.getElementById("scoreProgress");
const scoreText = document.getElementById("scoreText");
const overlay = document.getElementById("loadingOverlay");

form.addEventListener("submit", async function (e) {
    e.preventDefault();

    overlay.classList.remove("hidden");

    const formData = new FormData(form);

    const response = await fetch("/analyze", {
        method: "POST",
        body: formData
    });

    const data = await response.json();

    overlay.classList.add("hidden");

    if (data.error) {
        alert(data.error);
        return;
    }

    resultSection.classList.remove("hidden");

    // Animate Score
    const score = data.match_score;
    const offset = 440 - (440 * score / 100);

    scoreProgress.style.transition = "stroke-dashoffset 1s ease";
    scoreProgress.style.strokeDashoffset = offset;
    scoreText.innerText = score + "%";

    // Render results
    resultContent.innerHTML = `
    <div><strong>Matched Keywords:</strong><br>${data.matched_keywords.join(", ")}</div>
    <div><strong>Missing Keywords:</strong><br>${data.missing_keywords.join(", ")}</div>
    <div><strong>Spelling Issues:</strong><br>${data.spell_issues.join(", ")}</div>
    <div><strong>Weak Sentences:</strong><br>${data.weak_sentences.join("<br>")}</div>
    <div><strong>Suggestions:</strong><br>${data.improvement_suggestions.join("<br>")}</div>
    <hr class="my-4"/>
    <div>
        <strong>Resume Preview:</strong>
        <div class="mt-2 p-4 border rounded bg-gray-50 text-sm max-h-64 overflow-y-auto">
            ${data.highlighted_resume}
        </div>
    </div>
`;
});
</script>

</body>
</html>
